FROM centos:7
MAINTAINER "Ted Piecora" <tpiecora@gmail.com>

RUN yum install -y epel-release && centos-release-scl && yum clean all
RUN yum install -y java-1.7.0-openjdk nginx && yum clean all
# ENV PATH=/opt/rh/devtoolset-3/root/usr/bin:/opt/rh/python27/root/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/ajava/default/bin:/usr/local/spark/bin:/usr/local/hadoop/bin

RUN export JAVA_HOME=$(/usr/libexec/java_home)

COPY ./certs/ /certs/
#RUN sudo keytool -import -trustcacerts -file /certs/kinesis.pem -storepass changeit -noprompt -alias localKinesis -keystore /usr/java/jdk1.7.0_99/jre/lib/security/cacerts
#RUN sudo keytool -import -trustcacerts -file /certs/dynamo.pem  -storepass changeit -noprompt -alias localDynamo  -keystore /usr/java/jdk1.7.0_99/jre/lib/security/cacerts


ENV AWS_ACCESS_KEY_ID=AAAAAAAAAAAAAAAAAAAA
ENV AWS_SECRET_ACCESS_KEY=ZBBBBBBBBBBBBBBBB/ooooooooooooooooooooo0

RUN rm /etc/nginx/conf.d/*.conf
COPY ./cluster-nginx.conf /etc/nginx/conf.d/cluster-nginx.conf

EXPOSE 8080 8081

COPY ./start.sh /etc/start.sh
RUN chmod 755 /etc/start.sh

ENTRYPOINT ["/etc/start.sh"]



